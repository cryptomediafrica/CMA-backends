"use strict";!function(){function t(t,e=-1){return BOXCoin.loading(t,e)}function e(t,e={},c=!1){return BOXCoin.ajax(t,e,c)}function c(t,e=!0){return BOXCoin.activate(t,e)}function a(t,e=!1){L.card(t,e)}function i(t){return BXC_TRANSLATIONS&&t in BXC_TRANSLATIONS?BXC_TRANSLATIONS[t]:t}function n(t,e=!1){L.error(t,e)}function o(t,e=-1){return t&&_(t).length()?(t=_(t).e[0],-1===e?_(t).is("checkbox")?t.checked:t.value.trim():void(_(t).is("checkbox")?t.checked=e:t.value=e)):""}function r(t){return _(t).find("input, select, textarea")}function s(){let t=window.location.href;if(t.includes("#")){let e=t.substr(t.indexOf("#"));if(e.length>1){let t=f.find(".bxc-nav "+e);if(t.length)return d(t),!0}}return!1}function d(a){let i=f.find("main > div"),n=a.index();switch(x=_(i.e[n]),p=a.attr("id"),f.removeClass("bxc-area-transactions bxc-area-checkouts bxc-area-balances bxc-area-settings").addClass("bxc-area-"+p),c(i,!1),c(a.siblings(),!1),c(a),c(x),window.location.href.includes(p)||window.history.pushState("","","#"+p),p){case"transactions":t(x)||(t(x),w=0,k.find("tbody").html(""),R.print(()=>{t(i.e[n],!1)}));break;case"checkouts":x.hasClass("bxc-loading")&&e("get-checkouts",{},e=>{let c="";$=e;for(var a=0;a<e.length;a++)c+=O.row(e[a]);l(f.find("#bxc-table-checkouts tbody"),c),t(i.e[n],!1)});break;case"balances":L.balance(x);break;case"settings":x.hasClass("bxc-loading")&&e("get-settings",{},e=>{for(var c in e)o(r(f.find(`#${c}`)),e[c]);t(i.e[n],!1)})}}function l(t,e,c=!1){if(!e)return!t.html()&&t.html(`<p id="bxc-not-found">${i("There's nothing here yet.")}</p>`);t.find("#bxc-not-found").remove(),t.html((c?t.html():"")+e)}var u,f,h,b,x,p,m,k,v,g=[!1,!1,!1,!1],w=0,C=!0,y=new Date,$=!1,B=window.innerWidth<769,X=!1,_=window._query,R={get:function(t,c=!1,a=!1,i=!1,n=!1){e("get-transactions",{pagination:w,search:c,status:a,cryptocurrency:i,date_range:n},e=>{w++,t(e)})},print:function(t,e=g[0],c=g[1],a=g[2],n=g[3]){this.get(e=>{let c="";C=e.length;for(var a=0;a<C;a++){let t=e[a],n=t.from?`<a href="${L.explorer(t.cryptocurrency,t.from)}" target="_blank" class="bxc-link">${t.from}</a>`:"";c+=`<tr data-id="${t.id}" data-cryptocurrency="${t.cryptocurrency}" data-hash="${t.hash}"><td class="bcx-td-time"><div class="bxc-title">${BOXCoin.beautifyTime(t.creation_time,!0)}</div></td><td class="bxc-td-title"><div class="bxc-title">${t.title}</div><div class="bxc-text">${t.description}</div></td><td>${n}</td><td><a href="${L.explorer(t.cryptocurrency,t.to)}" target="_blank" class="bxc-link">${t.to}</a></td><td class="bxc-td-status"><span class="bxc-status-${t.status}">${i("C"==t.status?"Completed":"Pending")}</span></td><td class="bxc-td-amount"><div class="bxc-title">${t.amount} ${t.cryptocurrency.toUpperCase()}</div><div class="bxc-text">${t.currency.toUpperCase()} ${t.amount_fiat}</div></td></tr>`}l(k.find("tbody"),c,!0),t&&t(e)},e,c,a,n)},query:function(e=!1){t(k)||(k.find("tbody").html(""),w=0,g[0]=_(f).find("#bxc-search-transactions").val().toLowerCase().trim(),g[1]=_(f).find("#bxc-filter-status li.bxc-active").attr("data-value"),g[2]=_(f).find("#bxc-filter-cryptocurrency li.bxc-active").attr("data-value"),g[3]=!!X&&X.getDates("yyyy-mm-dd"),this.print(()=>{e&&t(e,!1),t(k,!1)}))},download:function(t){e("download-transactions",{search:g[0],status:g[1],cryptocurrency:g[2],date_range:g[3]},e=>{t(e)})}},O={row:function(t){return`<tr data-checkout-id="${t.id}"><td><div class="bxc-title"><span>${t.id}</span><span>${t.title}</span></div></td><td><div class="bxc-text">${t.currency?t.currency:BXC_CURRENCY} ${t.price}</div></td></tr>`},embed:function(t=!1){let e=v?3:2;for(var c=0;c<e;c++){let e=x.find("#bxc-checkout-"+(0==c?"payment-link":1==c?"embed-code":"shortcode")).find("div, i");if(t){let a=0==c?`${BXC_URL}pay.php?checkout_id=${t}`:1==c?`<div data-boxcoin="${t}"></div>`:`[boxcoin id="${t}"]`;_(e.e[0]).html(a.replace(/</g,"&lt;")),_(e.e[1]).attr("data-text",window.btoa(a))}else _(e.e[0]).html(""),_(e.e[1]).attr("data-text","")}},get:function(t,e=!1){for(var c=0;c<$.length;c++)if(t==$[c].id)return e?($.splice(c,1),!0):$[c];return!1}},L={card:function(t,e=!1){var c=f.find(".bxc-info-card");e?"error"==e?c.addClass("bxc-info-card-error"):c.addClass("bxc-info-card-info"):(c.removeClass("bxc-info-card-error bxc-info-card-warning bxc-info-card-info"),clearTimeout(h)),c.html(i(t)),h=setTimeout(()=>{c.html("")},5e3)},error:function(e,c=!1){window.scrollTo({top:0,behavior:"smooth"}),f.find(".bxc-info").html(e),c&&t(c,!1)},balance:function(c){t(c)||e("get-balances",{},e=>{let a="",i=e.balances;f.find("#bxc-balance-total").html(`${BXC_CURRENCY} ${e.total}`);for(var n in i)a+=`<tr data-cryptocurrency="${n}"><td><div class="bxc-flex"><img src="${BXC_URL}media/icon-${n}.svg" /> ${i[n].name}</div></td><td><div class="bxc-balance bxc-title">${i[n].amount} ${n.toUpperCase()}</div><div class="bxc-text">${BXC_CURRENCY} ${i[n].fiat}</div></td></tr>`;f.find("#bxc-table-balances tbody").html(a),t(c,!1)})},explorer:function(t,e,c="address"){let a="",i="address"==c?"address":"tx";switch(t){case"btc":a="https://www.blockchain.com/btc/{R}/{V}";break;case"link":case"bat":case"shib":case"usdc":case"usdt":case"eth":a="https://www.blockchain.com/eth/{R}/{V}";break;case"doge":a="https://dogechain.info/{R}/{V}";break;case"algo":a="https://algoexplorer.io/{R}/{V}"}return a.replace("{R}",i).replace("{V}",e)}};window.BXCTransactions=R,window.BXCCheckout=O,window.BXCAdmin=L,document.addEventListener("DOMContentLoaded",()=>{if(u=_(document.body),f=u.find(".bxc-main"),b=f.find("main > div"),x=b.e[0],k=f.find("#bxc-table-transactions"),v="undefined"!=typeof BXC_WP,BOXCoin.cookie("BXC_LOGIN")&&!f.hasClass("bxc-installation")){p="transactions",s()||R.print(()=>{t(x,!1)});let c=localStorage.getItem("bxc-cron");c&&c==y.getDate()||(e("cron"),localStorage.setItem("bxc-cron",y.getDate())),L.balance(f.find('main > [data-area="balance"]'))}k.on("click","tr",function(t){if(_(t.target).is("a"))return;let e=_(this).attr("data-hash");if(e){let t=_(this).attr("data-cryptocurrency");window.open(L.explorer(t,e,"tx"))}}),f.on("click","#bxc-filters",function(){f.find(".bxc-nav-filters").toggleClass("bxc-active")}),f.on("click","#bxc-filter-date,#bxc-filter-date-2",function(){let t={maxNumberOfDates:2,maxDate:new Date,dateDelimiter:" - ",clearBtn:!0};X||(_.load(BXC_URL+"vendor/datepicker/datepicker.min.css",!1),_.load(BXC_URL+"vendor/datepicker/datepicker.min.js",!0,()=>{BXC_LANG?(t.language=BXC_LANG,_.load(`${BXC_URL}vendor/datepicker/locales/${BXC_LANG}.js`,!0,()=>{(X=new DateRangePicker(_(this).parent().e[0],t)).datepickers[0].show()})):(X=new DateRangePicker(_(this).parent().e[0],t)).datepickers[0].show()}))}),f.on("click","#bxc-filter-status li,#bxc-filter-cryptocurrency li, .datepicker-cell, .datepicker .clear-btn",function(){setTimeout(()=>{R.query()},100)}),f.on("click","#bxc-download-transitions",function(){t(this)||R.download(e=>{window.open(e),t(this,!1)})}),f.on("click","#bxc-create-checkout, #bxc-table-checkouts td",function(){if(f.addClass("bxc-area-create-checkout"),_(this).is("td")){let e=_(this).parent().attr("data-checkout-id"),c=O.get(e);x.attr("data-checkout-id",e);for(var t in c){o(r(x.find(`#bxc-checkout-${t}`)),c[t])}O.embed(e)}else r(x).e.forEach(t=>{o(t,"")}),x.find("#bxc-checkout-type select").val("I"),x.attr("data-checkout-id",""),O.embed()}),f.on("click","#bxc-checkouts-list",function(){f.removeClass("bxc-area-create-checkout"),x.attr("data-checkout-id","")}),f.on("click","#bxc-save-checkout",function(){if(t(this))return;let c=!1,i={},r=x.find(".bxc-input"),s=x.attr("data-checkout-id");f.find(".bxc-info").html(""),r.removeClass("bxc-error"),r.e.forEach(t=>{let e=_(t).attr("id"),a=_(t).find("input, select"),n=o(a);!n&&a.length()&&a.attr("required")&&(c=!0,_(t).addClass("bxc-error")),i[e.replace("bxc-checkout-","")]=n}),c?n("Fields in red are required.",this):(s&&(i.id=s),e("save-checkout",{checkout:i},e=>{t(this,!1),Number.isInteger(e)?(i.id=e,x.attr("data-checkout-id",e),x.find("#bxc-table-checkouts tbody").append(O.row(i)),O.embed(e),$.push(i),a("Checkout saved successfully")):!0===e?(O.get(s,!0),$.push(i),x.find(`tr[data-checkout-id="${s}"]`).replace(O.row(i)),a("Checkout saved successfully")):n(e,this.closest("form"))}))}),f.on("click","#bxc-delete-checkout",function(){if(t(this))return;let c=x.attr("data-checkout-id");e("delete-checkout",{checkout_id:c},()=>{t(this,!1),x.attr("data-checkout-id",""),x.find(`tr[data-checkout-id="${c}"]`).remove(),x.find("#bxc-checkouts-list").e[0].click(),a("Checkout deleted","error")})}),f.on("click","#bxc-save-settings",function(){if(t(this))return;let c={};f.find('[data-area="settings"]').find('.bxc-input[id]:not([data-type="multi-input"]),[data-type="multi-input"] [id]').e.forEach(t=>{c[_(t).attr("id")]=o(r(t))}),e("save-settings",{settings:JSON.stringify(c)},e=>{a(!0===e?"Settings saved":e,!0!==e&&"error"),t(this,!1)})}),f.on("click","#update-btn a",function(c){if(!t(this))return e("update",{domain:BXC_URL},e=>{!0===e?(a("Update completed. Reload in progress..."),setTimeout(()=>{location.reload()},500)):"latest-version-installed"==e?a("You have the latest version"):a(function(t){return(t=t.replace(/_/g," ").replace(/-/g," ")).charAt(0).toUpperCase()+t.slice(1)}(e),"error"),t(this,!1)}),c.preventDefault(),!1}),B&&f.on("click",".bxc-icon-menu",function(){let t=_(this).parent();c(t,!t.hasClass("bxc-active"))}),f.on("click","#bxc-submit-installation",function(){if(t(this))return;let c=!1,a={},i=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,""),o=f.find(".bxc-input");if(o.removeClass("bxc-error"),f.find(".bxc-info").html(""),o.e.forEach(t=>{let e=_(t).attr("id"),i=_(t).find("input"),n=i.val().trim();!n&&i.attr("required")&&(c=!0,_(t).addClass("bxc-error")),a[e]=n}),c){c="Username, password and the database details are required.";let t=a.password;return t&&(t.length<8?c="Minimum password length is 8 characters.":t!=a["password-check"]&&(c="The passwords do not match.")),void n(c,this)}i.includes("?")&&(i=i.substr(0,i.indexOf("?"))),a.url=i+"/",e("installation",{installation_data:JSON.stringify(a)},t=>{!0===t?location.reload():n(t,this)})}),f.on("click",".bxc-nav > div",function(){d(_(this))}),f.on("click","#bxc-submit-login",function(){t(this)||e("login",{username:f.find("#username input").val().trim(),password:f.find("#password input").val().trim()},e=>{e?(BOXCoin.cookie("BXC_LOGIN",e,365,"set"),location.reload()):(f.find(".bxc-info").html("Invalid username or password."),t(this,!1))})}),f.on("click","#bxc-logout",function(){BOXCoin.cookie("BXC_LOGIN",!1,!1,"delete"),location.reload()}),f.on("click","#bxc-card",function(){_(this).html("")}),f.on("input",".bxc-search-input",function(){BOXCoin.search(this,(t,e)=>{"transactions"==p&&R.query(e,t)})}),f.on("click","#bxc-table-balances tr",function(){let t=_(this).attr("data-cryptocurrency");window.open(L.explorer(t,BXC_ADDRESS[t]))}),f.on("click",".bxc-select",function(){let t=_(this).find("ul"),e=t.hasClass("bxc-active");c(t,!e),e||setTimeout(()=>{m=t.e[0]},300)}),f.on("click",".bxc-select li",function(){let t=_(this.closest(".bxc-select")),e=_(this).attr("data-value");var a=t.find(`[data-value="${e}"]`);c(t.find("li"),!1),t.find("p").attr("data-value",e).html(a.html()),c(a,!0),m=!1}),window.onscroll=function(){window.scrollTop+window.innerHeight==_.documentHeight()&&C&&"transactions"==p&&(x.find(" > .bxc-loading-global").length||(R.print(()=>{window.scrollTo(0,document.body.scrollHeight-800),x.find(" > .bxc-loading-global").remove()},x.find(".bxc-search-input").val()),x.append('<div class="bxc-loading-global bxc-loading"></div>')))},window.onpopstate=function(){s()},document.addEventListener("click",function(t){m&&!m.contains(t.target)&&(c(m,!1),m=!1)})})}();